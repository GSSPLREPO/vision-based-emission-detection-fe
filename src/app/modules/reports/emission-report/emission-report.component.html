<form [formGroup]="dateForm">
    <div class="card mb-3 p-3">
      <div class="row">
          <!-- Date Input -->
          <div class=" col-sm-12 col-md-6 col-lg-6 col-xl-4">
            <div class="form-group mb-3">
              <label for="from" class="form-label">From Date & Time<span class="text-danger">*</span></label>
              <input type="datetime-local" step="1" min="1900-01-01T00:00" max="2099-12-31T23:59" formControlName="from" class="form-control custom-focus-color" (ngModelChange)="getDateValidation()"/>
              @if(f.from.errors?.required){
                <div class="text-danger">From Date & Time is required</div>
              }
              <div *ngIf="this.fromDateCheck" class="text-danger mt-1">
                Invalid From Date
              </div>
            </div>
          </div>
  
      
          <div class=" col-sm-12 col-md-6 col-lg-6 col-xl-4">
            <div class="form-group mb-3">
              <label for="to" class="form-label">To Date & Time<span class="text-danger">*</span></label>
              <input type="datetime-local" step="1" min="1900-01-01T00:00" max="2099-12-31T23:59" formControlName="to" class="form-control custom-focus-color" (ngModelChange)="getDateValidation()"/>
              @if(f.to.errors?.required){
                <div class="text-danger">To Date & Time is required</div>
              }
              <div *ngIf="this.toDateCheck" class="text-danger mt-1">
                Invalid To Date
              </div>
            </div>
            @if(dateValidation && !fromDateCheck && !toDateCheck){
              <div class="text-danger">
                  To Date & Time cannot be earlier than From Date & Time
              </div>
              }
          </div>
          
          <div  class=" col-sm-12 col-md-6 col-lg-6 col-xl-4"> 
            <div class="form-group mb-3">
                <label for="chimneyId" class="form-label">Chimney ID</label>
                <input type="text" formControlName="chimneyId" class="form-control custom-focus-color" placeholder="Enter the Chimney ID/Chimney Name">
            </div>
          </div>
  
      
          <div class="col-sm-12 col-md-6 col-lg-6 col-xl-4">
            <div style="margin-top: 31px;">
              <div class="row">
                <div class="col-auto">
    
                  <button type="button" class="btn btn-pur custom-focus-color" (click)="onGenerate()">
                    @if(showLoader){
                      <i class="fa fa-spinner fa-spin me-2"></i>Loading
                    }
                    @else{
                      <i class="fa fa-random me-2" aria-hidden="true"></i>Generate
                    }
                  </button>
                
                </div>
                <!-- @if(reportData?.length > 0 && !showLoader){
                  <div class="col-auto">
                    <button class="btn btn-excel ms-1" style="width: 40px;" (click)="generateExcel(reportData)">
                       <i class="fa-solid fa-file-excel "></i>
                    </button>
                  </div>

                  <div class="col-auto">
                    <button class="btn btn-pdf" style="width: 40px;" (click)="generatePDF()" >
                       <i class="fa fa-file-pdf-o" ></i>
                    </button>
                  </div>
                } -->
              </div>
          </div>
          </div>
        </div>
    </div>
  </form>
  

  <div class="card mb-3 p-4" [hidden]="!reportData">
       <div class="row g-3">
        <div class="col-auto">
          <input
            type="email"
            class="form-control mb-3"
            id="exampleFormControlInput1"
            (keyup)="doFilter($event)"
            placeholder="Search"
          />
        </div>
      </div>
       <div class="mat-elevation-z8">
        <div class="table-responsive">

          <table mat-table [dataSource]="dataSource" matSort>

            <!-- Header Row 1: Main Headers -->
            <ng-container matColumnDef="rowIndex">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Sr No.</th>
              <td mat-cell *matCellDef="let element" style="text-align: right;">{{ element.rowIndex }}</td>
            </ng-container>

            <ng-container matColumnDef="chimneyId">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Chimney Name</th>
              <td mat-cell *matCellDef="let element" style="text-align: right;">CH-{{ element.chimneyId }}</td>
            </ng-container>

            <ng-container matColumnDef="emissionStartDateTime">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Emission Start Time</th>
              <td mat-cell *matCellDef="let element" style="text-align: right;">{{ element.emissionStartDateTime | date : 'dd-MM-yyyy HH:mm:ss' }}</td>
            </ng-container>

            <ng-container matColumnDef="emissionEndDateTime">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Emission End Time</th>
              <td mat-cell *matCellDef="let element" style="text-align: right;">{{ element.emissionEndDateTime | date : 'dd-MM-yyyy HH:mm:ss' }}</td>
            </ng-container>

            <ng-container matColumnDef="duration">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Duration (hh:mm:ss)</th>
              <td mat-cell *matCellDef="let element" style="text-align: right;">{{ element.duration }}</td>
            </ng-container>

            <!-- <ng-container matColumnDef="color">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Color of Gas</th>
              <td mat-cell *matCellDef="let element" style="text-align: right;">
                <div [innerHTML]="element.color"></div>
              </td>
            </ng-container> -->

            <ng-container matColumnDef="isEmission">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Status of Emission</th>
              <td mat-cell *matCellDef="let element">
                  @if (element.isEmission)
                  {
                    <div class="d-flex align-items-center justify-content-center rounded p-2"
                         style="background-color: rgba(220, 53, 69, 0.15); color: #b02a37;">
                      <i class="fa fa-smog me-2" style="font-size: 1rem;"></i>
                      Emission Ongoing
                    </div>
                  }
                  @else {
                    <div class="d-flex align-items-center justify-content-center rounded p-2"
                         style="background-color: rgba(40, 167, 69, 0.15); color: #1e7e34;">
                      <i class="fa fa-check-circle me-2" style="font-size: 1rem;"></i>
                      Emission Stopped
                    </div>
                  }

              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="['rowIndex', 'chimneyId', 'emissionStartDateTime', 'emissionEndDateTime', 'duration',  'isEmission']"></tr>
            <tr mat-row *matRowDef="let row; columns: ['rowIndex', 'chimneyId', 'emissionStartDateTime', 'emissionEndDateTime', 'duration', 'isEmission']"></tr>
          
            <!-- No Data Row -->
            <tr *matNoDataRow>
                <td [colSpan]="30" class="no-data">
                  No data available
                </td>
            </tr>
          
          </table>
          
        </div>
        
      <mat-paginator
      [pageSizeOptions]="[5, 10, 20]"
      showFirstLastButtons
      aria-label="Select page of periodic elements"
    >
    </mat-paginator>
  </div>
</div>